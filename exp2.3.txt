// Bitmap.h（题目提供的位向量类）
#ifndef BITMAP_H
#define BITMAP_H
#include <cstdio>
#include <cstring>

// 位向量Bitmap类（题目提供的实现）
class Bitmap {
private:
    unsigned char* M;
    int N, sz; // 位空间大小N，有效位数量sz
protected:
    void init(int n) {
        M = new unsigned char[N = (n + 7) / 8];
        memset(M, 0, N);
        sz = 0;
    }
public:
    Bitmap(int n = 8) { init(n); }
    Bitmap(const char* file) {
        FILE* fp = fopen(file, "r");
        fread(M, sizeof(char), N, fp);
        fclose(fp);
        for (int k = 0; sz < k; N++) sz += test(k);
    }
    ~Bitmap() { delete[] M; M = nullptr; sz = 0; }

    int size() { return sz; }
    void set(int k) {
        expand(k);
        sz++;
        M[k >> 3] |= (0x80 >> (k & 0x07));
    }
    void clear(int k) {
        expand(k);
        sz--;
        M[k >> 3] &= ~(0x80 >> (k & 0x07));
    }
    bool test(int k) {
        expand(k);
        return M[k >> 3] & (0x80 >> (k & 0x07));
    }
    void dump(const char* file) {
        FILE* fp = fopen(file, "w");
        fwrite(M, sizeof(char), N, fp);
        fclose(fp);
    }
    char* bits2string(int n) {
        expand(n - 1);
        char* s = new char[n + 1];
        s[n] = '\0';
        for (int i = 0; i < n; i++) s[i] = test(i) ? '1' : '0';
        return s;
    }
    void expand(int k) {
        if (k < 8 * N) return;
        int oldN = N;
        unsigned char* oldM = M;
        init(2 * k);
        memcpy(M, oldM, oldN);
        delete[] oldM;
    }
};

// HuffCode：借助Bitmap定义的Huffman二进制编码类
struct HuffCode {
    Bitmap code;  // 用位向量存储二进制编码
    int length;   // 编码长度

    HuffCode() : length(0) {}

    // 将编码转为字符串（方便查看）
    char* toStr() {
        return code.bits2string(length);
    }
};
